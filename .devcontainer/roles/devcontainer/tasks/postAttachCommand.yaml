- name: Setup precommit
  block:
    - name: Setup precommit hook
      community.general.git_config:
        name: init.templateDir
        scope: global
        value: ~/.git-template
    - name: Setup precommit template
      ansible.builtin.command:
        cmd: pre-commit init-templatedir -t pre-commit ~/.git-template
      changed_when: false

- name: Setup ansible repo
  block:
    - name: Install requirements
      changed_when: false
      ansible.builtin.command:
        chdir: ../
        cmd: ansible-galaxy install -r requirements.yaml

- name: Setup gitignore file
  block:
    - name: Set gitignore template URL
      ansible.builtin.set_fact:
        gitignore_url: https://www.toptal.com/developers/gitignore/api/{{ gitignore_list | sort | join(',') }}
    - name: Get gitignore template
      ansible.builtin.set_fact:
        gitignore_template: "{{ lookup('ansible.builtin.url', gitignore_url, wantlist=true) }}"
    - name: Setup gitignore
      ansible.builtin.template:
        src: .gitignore.j2
        dest: ../.gitignore
        mode: "0644"

- name: Setup precommit
  block:
    - name: Install precommit
      ansible.builtin.command:
        chdir: ../
        cmd: pre-commit install
      changed_when: false
