- name: Create a new {{ patition_loop_var.value.fs_type }} primary partition for {{ patition_loop_var.key }} disks
  community.general.parted:
    device: /dev/disk/by-id/{{ disks_list_loop_var.id }}
    number: 1
    fs_type: "{{ patition_loop_var.value.fs_type }}"
    label: gpt
    state: present
  loop: "{{ patition_loop_var.value.disks_list }}"
  loop_control:
    loop_var: disks_list_loop_var

- name: Make filesystem for the {{ patition_loop_var.key }} disks
  community.general.filesystem:
    fstype: "{{ patition_loop_var.value.fs_type }}"
    dev: /dev/disk/by-id/{{ disks_list_loop_var.id }}-part1
  loop: "{{ patition_loop_var.value.disks_list }}"
  loop_control:
    loop_var: disks_list_loop_var
