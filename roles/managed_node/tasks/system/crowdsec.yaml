- name: Setup crowdsec
  block:
    - name: Setup crowdsec repository
      ansible.builtin.get_url:
        url: https://packagecloud.io/install/repositories/crowdsec/crowdsec/script.rpm.sh
        dest: /crowdsec.sh
        mode: +x

    - name: Setup crowdsec repository
      changed_when: false
      ansible.builtin.command:
        cmd: /crowdsec.sh

    - name: Remove install script
      ansible.builtin.file:
        path: /crowdsec.sh
        state: absent

    - name: Install crowdsec
      ansible.builtin.dnf:
        name:
          - crowdsec
          - crowdsec-firewall-bouncer-iptables
        state: latest
