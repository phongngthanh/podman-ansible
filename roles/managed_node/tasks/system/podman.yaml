- name: Podman
  become: True
  ansible.builtin.dnf:
    name:
      - podman-docker
      - slirp4netns
    state: latest

- name: Podman testing repo
  become: True
  ansible.builtin.dnf:
    name:
      - podman
    enablerepo: updates-testing
    state: latest
  when: podman_install_beta

- name: Install podman
  become: True
  ansible.builtin.dnf:
    name:
      - podman
    state: latest
  when: not podman_install_beta

- name: Enable podman socket
  ansible.builtin.systemd:
    daemon_reload: yes
    enabled: yes
    name: podman.socket
    scope: user
    state: started

- name: Enable podman autoupdate timer
  ansible.builtin.systemd:
    daemon_reload: yes
    enabled: yes
    name: podman-auto-update.timer
    scope: user
    state: started

- name: Setup privileged ports
  ansible.builtin.sysctl:
    name: net.ipv4.ip_unprivileged_port_start
    sysctl_set: yes
    value: "80"
  become: yes
