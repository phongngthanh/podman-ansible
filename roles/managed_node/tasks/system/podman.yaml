- name: Setup podman
  tags: podman_install
  become: true
  block:
    - name: Podman
      ansible.builtin.dnf:
        name:
          - podman-docker
          - slirp4netns
        state: latest

    - name: Install podman
      ansible.builtin.dnf:
        name:
          - podman
        state: latest

    - name: Setup privileged ports for rootless podman
      ansible.posix.sysctl:
        name: net.ipv4.ip_unprivileged_port_start
        sysctl_set: true
        value: "80"

- name: Enable podman autoupdate timer
  ansible.builtin.systemd:
    daemon_reload: true
    enabled: true
    name: podman-auto-update.timer
    scope: user
    state: started

- name: Enable podman autoupdate timer for root
  become: true
  ansible.builtin.systemd:
    daemon_reload: true
    enabled: true
    name: podman-auto-update.timer
    state: started

- name: Enable podman socket
  ansible.builtin.systemd:
    daemon_reload: true
    enabled: true
    name: podman.socket
    scope: user
    state: started
