- become: true
  block:
    - name: Manage storage disks
      include_tasks: mount/storage.yaml
      loop: "{{ disks.storage.disks_list }}"
      loop_control:
        loop_var: storage_loop_var

    - name: Mergerfs storage disk
      ansible.posix.mount:
        path: /mnt/storage
        src: /mnt/disks/storage/data/*
        fstype: fuse.mergerfs
        opts: category.create=mspmfs,nonempty,allow_other,use_ino,cache.files=off,moveonenospc=true,dropcacheonclose=true,minfreespace=200G,fsname=mergerfs
        state: mounted

    - name: Mount parity disks
      ansible.posix.mount:
        path: "/mnt/disks/parity/{{ item.id }}"
        src: "/dev/disk/by-id/{{ item.id }}-part1"
        fstype: ext4
        state: mounted
      loop: "{{ disks.parity.disks_list }}"
