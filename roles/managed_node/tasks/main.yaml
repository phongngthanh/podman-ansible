- name: Harden ssh
  import_tasks: system/ssh.yaml
  when: ansible_user != "root"

- name: Setup hostname
  import_tasks: system/hostname.yaml

- name: Setup Podman
  import_tasks: system/podman.yaml
  tags: podman

- name: Install packages
  import_tasks: system/packages.yaml
  tags: packages

- name: Setup user systemd
  import_tasks: system/systemd/user.yaml

- name: Setup storage mounts
  import_tasks: system/mount.yaml
  tags: mount

- name: Setup snapraid
  import_tasks: system/snapraid.yaml

- name: Setup system systemd
  import_tasks: system/systemd/system.yaml
  tags: systemd

- name: Setup Virtualization
  import_tasks: system/virtualization.yaml
  tags: virt

# TODO: Run only if detect nvidia GPU
- name: Setup nvidia driver
  import_tasks: system/nvidia.yaml
  tags: nvidia

# - name: Install crowdsec
#   import_tasks: system/crowdsec.yaml
#   tags: crowdsec

- name: Install netdata
  import_role:
    name: netdata

- name: Miscellaneous settings
  ansible.builtin.import_tasks: system/misc.yaml
  tags: misc

- name: Automatic update packages
  import_tasks: system/auto_update.yaml
