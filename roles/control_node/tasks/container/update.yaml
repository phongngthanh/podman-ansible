- name: Create user systemd folder
  file:
    path: './.config/systemd/user'
    state: directory

- name: Copy sample file to remote
  ansible.builtin.copy:
    src: 'container_systemd/update/container-update_sample.service'
    dest: './.config/systemd/user/container-update.service'

- name: Edit systemd file
  ansible.builtin.replace:
    path: './.config/systemd/user/container-update.service'
    regexp: 'ServiceDirectory'
    replace: '{{ global_container_run_path }}'

- name: Copy sample update timer file to remote
  ansible.builtin.copy:
    src: 'container_systemd/update/container-update_sample.timer'
    dest: './.config/systemd/user/container-update.timer'

- name: Edit timer for autoupdate systemd file
  ansible.builtin.replace:
    path: './.config/systemd/user/container-update.timer'
    regexp: 'CalendarTimer'
    replace: '{{ global_container_update_timer }}'

- name: Run timer for auto update container systemd
  ansible.builtin.systemd:
    daemon_reload: yes
    scope: user
    enabled: yes
    state: started
    name: container-update.timer