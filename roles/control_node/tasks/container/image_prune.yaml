- name: Create user systemd folder
  file:
    path: './.config/systemd/user'
    state: directory

- name: Copy image-prune remote
  ansible.builtin.copy:
    src: 'container_systemd/image-prune/container-image-prune_sample.service'
    dest: './.config/systemd/user/container-image-prune.service'

- name: Copy image-prune timer file to remote
  ansible.builtin.copy:
    src: 'container_systemd/image-prune/container-image-prune_sample.timer'
    dest: './.config/systemd/user/container-image-prune.timer'

- name: Edit image-prune timer for systemd file
  ansible.builtin.replace:
    path: './.config/systemd/user/container-image-prune.timer'
    regexp: 'CalendarTimer'
    replace: '{{ global_container_update_timer }}'

- name: Run timer systemd
  ansible.builtin.systemd:
    daemon_reload: yes
    scope: user
    enabled: yes
    state: started
    name: container-image-prune.timer