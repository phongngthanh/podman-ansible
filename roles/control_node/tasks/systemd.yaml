- name: Template the ansible systemd service
  vars:
    - systemd_description: '{{ item.systemd_description }}'
    - systemd_playbook: '{{ item.name }}'
  ansible.builtin.template:
    src: container/ansible.service.j2
    dest: './.config/systemd/user/{{ item.name }}.service'
  loop: '{{ systemd.ansible.service }}'

- name: Template the ansible timer
  vars:
    - timer_description: '{{ item.timer_description }}'
  ansible.builtin.template:
    src: container/ansible.timer.j2
    dest: './.config/systemd/user/{{ item.name }}.timer'
  loop: '{{ systemd.ansible.timer }}'

- name: Run the systemd service
  ansible.builtin.systemd:
    daemon_reload: yes
    scope: user
    enabled: yes
    state: started
    name: '{{ item.name }}'
  loop: '{{ systemd.ansible.service }}'

- name: Run the systemd timer
  ansible.builtin.systemd:
    daemon_reload: yes
    scope: user
    enabled: yes
    state: started
    name: '{{ item.name }}'
  loop: '{{ systemd.ansible.timer }}'