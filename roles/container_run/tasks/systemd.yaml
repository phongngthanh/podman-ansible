- name: "Pod {{ service_name }} systemd"
  containers.podman.podman_pod:
    generate_systemd:
      container_prefix: ""
      new: true
      path: /home/{{ ansible_user }}/.config/systemd/user
      pod_prefix: ""
      separator: ""
    infra_name: "{{ service_name }}-pod"
    name: "{{ service_name }}"
    network: caddy
    state: "{{ service_state }}"

- name: "Enable {{ service_name }} systemd"
  ansible.builtin.systemd:
    name: "{{ service_name }}"
    daemon_reload: true
    enabled: true
    scope: user
    state: "{{ service_state }}"
  register: service
  until: service.failed == false
