- name: Jellyfin
  # The mpv-shim config file is conf.json
  # user: 1000:1000
  # Use host network_mode for DLNA
  # network_mode: host
  containers.podman.podman_container:
    env:
      TZ: "{{ global_timezone }}"
    group_add:
      - "998"
    image: "{{ jellyfin_image }}"
    labels:
      io.containers.autoupdate: registry
    name: jellyfin-web
    pod: jellyfin
    security_opt:
      - unmask=/sys/dev
    state: "{{ jellyfin_state }}"
    volumes:
      - "{{ global_media }}:/home"
      - "{{ jellyfin_web_cache }}:/cache:U,z"
      - "{{ jellyfin_web_config }}:/config:U,z"
      - /dev/dri/card0:/dev/dri/card0
      - /dev/dri/renderD128:/dev/dri/renderD128
  register: container
  until: container.failed == false
