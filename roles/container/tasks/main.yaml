- name: Setup container
  tags: container
  block:
    - name: Create podman systemd folder
      ansible.builtin.file:
        mode: "0755"
        path: "{{ ansible_user_dir }}/.config/containers/systemd"
        state: directory
    - name: Create network quadlet
      ansible.builtin.template:
        mode: "0644"
        src: quadlet/webserver.network.j2
        dest: "{{ ansible_user_dir }}/.config/containers/systemd/webserver.network"
    - name: Run podman container with systemd
      ansible.builtin.include_tasks:
        file: container.yaml
      args:
        apply:
          tags:
            - "{{ container_loop_var.key }}"
      loop: "{{ container | dict2items }}"
      loop_control:
        loop_var: container_loop_var
      tags:
        - always
      no_log: true
