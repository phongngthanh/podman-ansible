- name: Setup container
  tags: container
  block:
    - name: Create service podman network # noqa: args[module]
      containers.podman.podman_network:
        name: caddy
        state: "{{ network_state }}"

    - name: Run podman container with systemd
      ansible.builtin.include_tasks:
        file: container.yaml
      args:
        apply:
          tags:
            - "{{ container_loop_var.key }}"
      loop: "{{ container | dict2items }}"
      loop_control:
        loop_var: container_loop_var
      tags:
        - always
      no_log: true
