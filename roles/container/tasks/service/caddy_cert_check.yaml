- name: Check if {{ item }}/{{ caddy_cert_domain }} is available
  ansible.builtin.set_fact:
    caddy_cert_location_loop: "{{ caddy_data_data }}/caddy/certificates/{{ item }}/{{ caddy_cert_domain }}"
  when: not cert_available
- ansible.builtin.stat:
    path: "{{ caddy_cert_location_loop }}/{{ caddy_cert_domain }}.crt"
  register: caddy_cert_status
  retries: 10
  until: caddy_cert_status.stat.exists
  ignore_errors: true
  when: not cert_available
- ansible.builtin.set_fact:
    caddy_cert_location: "{{ caddy_data_data }}/caddy/certificates/{{ item }}/{{ caddy_cert_domain }}"
    cert_available: true
  when: not cert_available
