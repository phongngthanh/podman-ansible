- name: Samba
  # SAMBA_GLOBAL_CONFIG_case_SPACE_sensitive: "yes" # Need this option for case sensitive files. This breaks calibre on windows however. Reference: https://www.oreilly.com/openbook/samba/book/ch05_04.html
  containers.podman.podman_container:
    env:
      AVAHI_DISABLE: 1
      GROUP_root: 0
      SAMBA_GLOBAL_CONFIG_case_SPACE_sensitive: "yes"
      SAMBA_VOLUME_CONFIG_disk: "[Disk]; path=/shares/disk; {{ samba_shares_settings }}"
      SAMBA_VOLUME_CONFIG_disks: "[Disks]; path=/shares/disks; {{ samba_shares_settings }}"
      SAMBA_VOLUME_CONFIG_home: "[Home]; path=/shares/home; {{ samba_shares_settings }}"
      SAMBA_VOLUME_CONFIG_storage: "[Storage]; path=/shares/storage; {{ samba_shares_settings }}"
      UID_root: 0
      WSDD2_DISABLE: 1
    image: ghcr.io/servercontainers/samba:latest@sha256:b87e1dafc5e42f98437d67c8c4a47e05ce5ae7c8a0f7368d5a15b6c35d24e0eb
    name: samba
    network: host
    secrets:
      - samba_password,type=env,target=ACCOUNT_root
    volumes:
      - "{{ ansible_user_dir }}:/shares/home"
      - "{{ ansible_user_dir }}/disk:/shares/disk"
      - "{{ global_disks_data }}:/shares/disks"
      - "{{ global_storage }}:/shares/storage"
