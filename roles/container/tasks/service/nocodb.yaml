- name: Setup nocodb
  module_defaults:
    containers.podman.podman_container:
      labels:
        io.containers.autoupdate: registry
      pod: nocodb
      state: "{{ nocodb_state }}"
  block:
    - name: Nocodb DB
      containers.podman.podman_container:
        env:
          POSTGRES_DB: nocodb
          POSTGRES_PASSWORD: "{{ nocodb_db_password }}"
          POSTGRES_USER: "{{ nocodb_db_username }}"
          TZ: "{{ global_timezone }}"
        image: docker.io/postgres:13-alpine
        name: nocodb-db
        volumes:
          - "{{ nocodb_db_data }}:/var/lib/postgresql/data"

    - name: Nocodb Web
      containers.podman.podman_container:
        env:
          NC_DB: pg://localhost:5432?u={{ nocodb_db_username }}&p={{ nocodb_db_password }}&d=nocodb
        image: docker.io/nocodb/nocodb
        name: nocodb-web
        pod: nocodb
