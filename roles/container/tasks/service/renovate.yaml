- name: Setup config file
  ansible.builtin.import_role:
    name: common
    tasks_from: json_edit.yaml
  vars:
    json_file_path: "{{ renovate_volume_config }}"
    json_edit:
      autodiscover: false
      platform: github
      repositories:
        - zephyros-dev/media-server
      token: "{{ renovate_token }}"

- name: Renovate
  containers.podman.podman_container:
    env:
      LOG_LEVEL: DEBUG
      RENOVATE_CONFIG_FILE: /opt/renovate/config.json
    image: docker.io/renovate/renovate:latest@sha256:e4f62af2b8432c48b587e94e4d444f735ed4c1af76503f7f9e7b632c1d472581
    name: renovate-instance
    state: "{{ renovate_state }}"
    pod: renovate
    volumes:
      - "{{ renovate_volume_config }}:/opt/renovate/config.json:U,z"
      - "{{ renovate_volume_data }}:/tmp/renovate:U,z"
