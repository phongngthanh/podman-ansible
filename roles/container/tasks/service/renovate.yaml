- name: Setup config file
  ansible.builtin.import_role:
    name: common
    tasks_from: json_edit.yaml
  vars:
    json_file_path: "{{ renovate_volume_config }}"
    json_edit:
      autodiscover: false
      platform: github
      repositories:
        - zephyros-dev/media-server
      token: "{{ renovate_token }}"

- name: Renovate
  containers.podman.podman_container:
    env:
      LOG_LEVEL: DEBUG
      RENOVATE_CONFIG_FILE: /opt/renovate/config.json
    image: docker.io/renovate/renovate:latest@sha256:01ad0b3014ca7a8c4be0970aef305fff6dce24d939e72fb0df6a272e034d0f0d
    name: renovate
    state: "{{ renovate_state }}"
    volumes:
      - "{{ renovate_volume_config }}:/opt/renovate/config.json:U,z"
      - "{{ renovate_volume_data }}:/tmp/renovate:U,z"
