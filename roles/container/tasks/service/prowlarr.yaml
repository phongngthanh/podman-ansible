- name: Prowlarr
  containers.podman.podman_container:
    env:
      TZ: "{{ global_timezone }}"
    image: ghcr.io/linuxserver/prowlarr:latest@sha256:178ca71cf4694c238fd2324a9f3b9be8e8ac5763098bfeb48dfa945b1fd0aa04
    name: prowlarr-web
    volumes:
      - "{{ prowlarr_web_config }}:/config:U,z"

# https://wiki.servarr.com/prowlarr/faq
- name: Disable authentication for prowlarr
  become_method: containers.podman.podman_unshare
  become: true
  community.general.xml:
    path: "{{ prowlarr_web_config }}/config.xml"
    xpath: "{{ item.key }}"
    value: "{{ item.value }}"
  loop:
    - key: /Config/AuthenticationMethod
      value: Basic
    - key: /Config/AuthenticationRequired
      value: DisabledForLocalAddresses
  register: prowlarr_config

- name: Restart prowlarr # noqa: no-handler
  when: prowlarr_config.changed
  ansible.builtin.set_fact:
    container_recreate: true
