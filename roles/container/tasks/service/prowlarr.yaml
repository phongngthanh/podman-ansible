- name: Prowlarr
  containers.podman.podman_container:
    env:
      TZ: "{{ global_timezone }}"
    image: ghcr.io/linuxserver/prowlarr:latest@sha256:8e4fd116f827e28d79d1cf8d1f63053f7dbadf3897c66b2149a7fd3c75bbd914
    name: prowlarr-web
    volumes:
      - "{{ prowlarr_web_config }}:/config:U,z"

# https://wiki.servarr.com/prowlarr/faq
- name: Disable authentication for prowlarr
  become_method: containers.podman.podman_unshare
  become: true
  community.general.xml:
    path: "{{ prowlarr_web_config }}/config.xml"
    xpath: "{{ item.key }}"
    value: "{{ item.value }}"
  loop:
    - key: /Config/AuthenticationMethod
      value: Basic
    - key: /Config/AuthenticationRequired
      value: DisabledForLocalAddresses
  register: prowlarr_config

- name: Restart prowlarr # noqa: no-handler
  when: prowlarr_config.changed
  ansible.builtin.set_fact:
    container_recreate: true
