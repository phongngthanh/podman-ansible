- name: Prowlarr
  containers.podman.podman_container:
    image: ghcr.io/linuxserver/prowlarr:latest@sha256:8c5d3932109eed7d316d0b9e99285a71df86e85d7a1b9f72d70eb83de79475d1
    name: prowlarr-web
    volumes:
      - "{{ prowlarr_web_config }}:/config:U,z"

# https://wiki.servarr.com/prowlarr/faq
- name: Disable authentication for prowlarr
  become_method: containers.podman.podman_unshare
  become: true
  community.general.xml:
    path: "{{ prowlarr_web_config }}/config.xml"
    xpath: "{{ item.key }}"
    value: "{{ item.value }}"
  loop:
    - key: /Config/AuthenticationMethod
      value: Basic
    - key: /Config/AuthenticationRequired
      value: DisabledForLocalAddresses
  register: prowlarr_config

- name: Restart prowlarr # noqa: no-handler
  when: prowlarr_config.changed
  ansible.builtin.set_fact:
    container_recreate: true
