- name: Create container {{ container_loop_var.key }}
  ansible.builtin.include_tasks:
    file: container_quadlet.yaml

# https://wiki.servarr.com/prowlarr/faq
- name: Disable authentication for prowlarr
  become_method: containers.podman.podman_unshare
  become: true
  community.general.xml:
    path: "{{ prowlarr_web_config }}/config.xml"
    xpath: "{{ item.key }}"
    value: "{{ item.value }}"
  loop:
    - key: /Config/AuthenticationMethod
      value: Basic
    - key: /Config/AuthenticationRequired
      value: DisabledForLocalAddresses
  register: prowlarr_config

- name: Restart prowlarr # noqa: no-handler
  when: prowlarr_config.changed
  ansible.builtin.systemd:
    name: prowlarr
    scope: user
    state: restarted
