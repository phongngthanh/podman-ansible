- name: Create container {{ container_loop_var.key }}
  ansible.builtin.include_tasks:
    file: container_quadlet.yaml

# https://wiki.servarr.com/radarr/faq
- name: Disable authentication for radarr
  become_method: containers.podman.podman_unshare
  become: true
  community.general.xml:
    path: "{{ radarr_web_config }}/config.xml"
    xpath: "{{ item.key }}"
    value: "{{ item.value }}"
  loop:
    - key: /Config/AuthenticationMethod
      value: Basic
    - key: /Config/AuthenticationRequired
      value: DisabledForLocalAddresses
  register: radarr_config

- name: Restart radarr # noqa: no-handler
  when: radarr_config.changed
  ansible.builtin.systemd:
    name: radarr
    scope: user
    state: restarted
