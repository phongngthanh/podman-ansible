- name: Immich Server
  containers.podman.podman_container:
    name: immich-server
    image: docker.io/altran1502/immich-server:release@sha256:30b040593a14870bb01bde7dc904332672066d77a3c6d2fcae4b8bdf1fcb3d22
    command:
      - "/bin/sh"
      - "./start-server.sh"
    volumes:
      - "{{ immich_volume_upload }}:/usr/src/app/upload"
    env:
      DB_DATABASE_NAME: "{{ immich_database_db }}"
      DB_HOSTNAME: localhost
      DB_PASSWORD: "{{ immich_database_password }}"
      DB_USERNAME: "{{ immich_database_user }}"
      JWT_SECRET: "{{ immich_jwt_secret }}"
      NODE_ENV: production
      REDIS_HOSTNAME: localhost
      TZ: "{{ global_timezone }}"

- name: Immich Microservices
  containers.podman.podman_container:
    name: immich-microservices
    image: docker.io/altran1502/immich-server:release@sha256:30b040593a14870bb01bde7dc904332672066d77a3c6d2fcae4b8bdf1fcb3d22
    command:
      - "/bin/sh"
      - "./start-microservices.sh"
    volume:
      - "{{ immich_volume_upload }}:/usr/src/app/upload"
    env:
      DB_DATABASE_NAME: "{{ immich_database_db }}"
      DB_HOSTNAME: localhost
      DB_PASSWORD: "{{ immich_database_password }}"
      DB_USERNAME: "{{ immich_database_user }}"
      JWT_SECRET: "{{ immich_jwt_secret }}"
      NODE_ENV: production
      REDIS_HOSTNAME: localhost
      TZ: "{{ global_timezone }}"

- name: Immich Machine learning
  containers.podman.podman_container:
    name: immich-machine-learning
    image: docker.io/altran1502/immich-machine-learning:release@sha256:0db4a47dcbfeae7af9fb731c210783c12c477bc034934277b2eed1a217d4c8da
    command:
      - "/bin/sh"
      - "./entrypoint.sh"
    volumes:
      - "{{ immich_volume_upload }}:/usr/src/app/upload"
    env:
      NODE_ENV: production
      TZ: "{{ global_timezone }}"

- name: Immich Web
  containers.podman.podman_container:
    name: immich-web
    image: docker.io/altran1502/immich-web:release@sha256:d08aa9c07c0b608db3f58b672ba0354820182f239e9f44591d37f4da900b79a6
    command:
      - "/bin/sh"
      - "./entrypoint.sh"
    env:
      TZ: "{{ global_timezone }}"

- name: Immich Redis
  containers.podman.podman_container:
    name: immich-redis
    image: docker.io/redis:6-alpine@sha256:7b2510ea835cc2e15e3f5402a891be8f076ce505d41a31a4096ea146b970e7cb
    env:
      TZ: "{{ global_timezone }}"

- name: Immich Database
  containers.podman.podman_container:
    name: immich-database
    image: docker.io/postgres:14-alpine@sha256:c55e718fbf53f17476c6b7238fb21602950428fb1c827cfd14a91e9e0c1e3f6a
    env:
      POSTGRES_DB: "{{ immich_database_db }}"
      POSTGRES_PASSWORD: "{{ immich_database_password }}"
      POSTGRES_USER: "{{ immich_database_user }}"
      TZ: "{{ global_timezone }}"
    volumes:
      - "{{ immich_volume_database }}:/var/lib/postgresql/data"
