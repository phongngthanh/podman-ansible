- name: Immich Redis
  containers.podman.podman_container:
    name: immich-redis
    image: docker.io/redis:6-alpine@sha256:8f85548368e313971647f4d116b046139e96c71abf238749397c5a82bbbe6b4d
    env:
      TZ: "{{ global_timezone }}"

- name: Immich Database
  containers.podman.podman_container:
    name: immich-database
    image: docker.io/postgres:14-alpine@sha256:64c4073657f6ec64939adfd66cba765f11e42a0793600a9d274870865e04583a
    env:
      POSTGRES_DB: "{{ immich_database_db }}"
      POSTGRES_PASSWORD: "{{ immich_database_password }}"
      POSTGRES_USER: "{{ immich_database_user }}"
      TZ: "{{ global_timezone }}"
    volumes:
      - "{{ immich_volume_database }}:/var/lib/postgresql/data"

- name: Immich Typesense
  containers.podman.podman_container:
    name: immich-typesense
    image: docker.io/typesense/typesense:0.24.0@sha256:a30d306265dc55e99db4636888588019f62ea06020f06171422e1af7a1549fa1
    env:
      TYPESENSE_API_KEY: "{{ immich_typesense_api_key }}"
      TYPESENSE_DATA_DIR: /data
    volumes:
      - "{{ immich_volume_typesense }}:/data:U,z"

- name: Immich Server
  containers.podman.podman_container:
    name: immich-server
    image: ghcr.io/immich-app/immich-server:release@sha256:507468f11a9ed4b272ea7f935ed803faea6af7fb86edae02e7283ad80e394b12
    command:
      - "/bin/sh"
      - "./start-server.sh"
    volumes:
      - "{{ immich_volume_upload }}:/usr/src/app/upload"
    env:
      DB_DATABASE_NAME: "{{ immich_database_db }}"
      DB_HOSTNAME: localhost
      DB_PASSWORD: "{{ immich_database_password }}"
      DB_USERNAME: "{{ immich_database_user }}"
      JWT_SECRET: "{{ immich_jwt_secret }}"
      NODE_ENV: production
      REDIS_HOSTNAME: localhost
      TYPESENSE_API_KEY: "{{ immich_typesense_api_key }}"
      TYPESENSE_HOST: localhost
      TZ: "{{ global_timezone }}"

- name: Immich Microservices
  containers.podman.podman_container:
    name: immich-microservices
    image: ghcr.io/immich-app/immich-server:release@sha256:507468f11a9ed4b272ea7f935ed803faea6af7fb86edae02e7283ad80e394b12
    command:
      - "/bin/sh"
      - "./start-microservices.sh"
    volume:
      - "{{ immich_volume_upload }}:/usr/src/app/upload"
    env:
      DB_DATABASE_NAME: "{{ immich_database_db }}"
      DB_HOSTNAME: localhost
      DB_PASSWORD: "{{ immich_database_password }}"
      DB_USERNAME: "{{ immich_database_user }}"
      JWT_SECRET: "{{ immich_jwt_secret }}"
      NODE_ENV: production
      REDIS_HOSTNAME: localhost
      TYPESENSE_API_KEY: "{{ immich_typesense_api_key }}"
      TYPESENSE_HOST: localhost
      TZ: "{{ global_timezone }}"

- name: Immich Machine learning
  containers.podman.podman_container:
    name: immich-machine-learning
    image: ghcr.io/immich-app/immich-machine-learning:release@sha256:d8189311cc3c146bfb9f350cc6d6de16abb4cdb9e0d02c55ba86435689ec2b78
    volumes:
      - "{{ immich_volume_upload }}:/usr/src/app/upload"
      - "{{ immich_volume_ml_cache }}:/cache:U,z"
    env:
      NODE_ENV: production
      TZ: "{{ global_timezone }}"

- name: Immich Web
  containers.podman.podman_container:
    name: immich-web
    image: ghcr.io/immich-app/immich-web:release@sha256:b7cfc67f5e93caaa988b23871ba4d7661f33002af2c91a3ca8c89f44a59d28ec
    command:
      - "/bin/sh"
      - "./entrypoint.sh"
    env:
      TZ: "{{ global_timezone }}"
