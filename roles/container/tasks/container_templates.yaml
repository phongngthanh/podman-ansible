- name: Templates config files {{ container_loop_var.key }}
  module_defaults:
    ansible.builtin.template:
      src: "{{ container_templates_loop_var.src }}"
      dest: "{{ container_templates_loop_var.dest }}"
  block:
    - name: Check if config file exists
      ansible.builtin.stat:
        path: "{{ container_templates_loop_var.dest }}"
      register: config_file_stat
    - name: Create config files {{ container_loop_var.key }}
      when: not config_file_stat.stat.exists
      ansible.builtin.template:
        mode: "0600"
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
      register: restart_systemd
    - name: Templates config files {{ container_loop_var.key }}
      when: config_file_stat.stat.exists
      become: true
      ansible.builtin.template:
        mode: "0600"
      register: restart_systemd
