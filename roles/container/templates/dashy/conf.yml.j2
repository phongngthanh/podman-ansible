#jinja2:lstrip_blocks: True
pageInfo:
  title: Zephyr Server
  description: Homelab server of Zephyr
  navLinks:
    - title: Home
      path: /
    - title: About
      path: /about
    - title: Source Code
      path: https://github.com/zephyros-dev/media-server
appConfig:
  iconSize: large
  layout: vertical
  statusCheck: true
  theme: Material
sections:
  - name: All
    items:
{% set custom_dashy_service = {
  "calibre_content": {
    "caddy_proxy_port": "8081",
    "dashy_icon": "/favicon.png",
    "dashy_statusCheckUrl": "http://calibre:8081",
    "dashy_statusCheckAcceptCodes": "401"
  },
  "dashy": {},
  "netdata": {
    "caddy_proxy_port": "19999",
    "dashy_statusCheckAcceptCodes": "401"
  }
}
%}
{% set _ = systemd_container_service.update(custom_dashy_service) %}
{% for key, value in systemd_container_service | dictsort %}
{% set url_key = key.replace("_", "-") %}
{% set url_public = "https://" + url_key + "." + server_domain %}
  {% if value.caddy_proxy_port is defined %}
      - title: {{ key.capitalize().replace("_", " ") }}
        icon: {% if value.dashy_icon is not defined %}{{ "hl-" + key }}
              {% elif "/" in value.dashy_icon %}{{ "https://" + url_key + "." + server_domain + value.dashy_icon }}
              {% else %}{{ value.dashy_icon }}
              {% endif %}
  {% if value.caddy_sso is defined %}
    {% if value.caddy_sso %}
        statusCheckAllowInsecure: true
        statusCheckUrl: {% if value.dashy_statusCheckUrl is not defined %}
                          {% if value.caddy_host_network is defined %}
                            {% if value.caddy_host_network %}{{ "http://" + caddyfile_host_address + ":" + value.caddy_proxy_port }}
                            {% endif %}
                          {% else %}{{ "http://" + url_key + ":" + value.caddy_proxy_port }}
                          {% endif %}
                        {% else %}{{ value.dashy_statusCheckUrl }}
                        {% endif %}
    {% endif %}
  {% else %}
        statusCheckUrl: {{ url_public }}
  {% endif %}
  {% if value.dashy_statusCheckAcceptCodes is defined %}
        statusCheckAcceptCodes: "{{ value.dashy_statusCheckAcceptCodes }}"
  {% endif %}
        url: {{ url_public }}
  {% endif %}
{% endfor %}
